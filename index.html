<!DOCTYPE html>
<html>
<body>

<h1>GTM Test v13</h1>
  
<script>
// URL to Paste in search and change param values if need be
// https://rustumf.github.io/GTMRfo/?key=123&value=5001

// pull out URL and get params from URL
var docurl = document.URL;
var url = new URL(docurl);
  
var params = url.searchParams; 
var key_val = params.get('key');
var value_val = params.get('value');

// Display the param values for test that the values change when changed in URL
alert("key " + key_val);
alert("value " + value_val);
  
// Initialize GTM data layer
dataLayer = [];
  
// Push values GTM data layer
dataLayer.push({'key': key_val, 'value': value_val});
  
alert("from DL " + dataLayer[0].key);
alert("from DL " + dataLayer[0].value);

//function to setting the location using the Javascript 
function APILocation() {
            location = "https://httpbin.org/get?key=" + dataLayer[0].key + "&value=" + dataLayer[0].value;   
};
  

    function APILocation2() {

        location = "https://httpbin.org/get?key=" + dataLayer[0].key + "&value=" + dataLayer[0].value;
      
        let xmlhttp = new XMLHttpRequest();
        xmlhttp.open('GET', location, true);

        xmlhttp.onreadystatechange = function () {

            if (xmlhttp.readyState == 4) {

                if (xmlhttp.status == 200) {

                    alert(xmlhttp.responseText);

                }
            }
        };

    };  

</script>
  
<button onclick ="APILocation2()">
         GET API Request
      </button>
  
</body>
</html>

